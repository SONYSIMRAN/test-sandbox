<template>
    <template if:true={testDataLoader}>
        <c-dx-vis-loader></c-dx-vis-loader>
    </template>
    <template lwc:if={executionResults}>
        <template if:false={testDataLoader}>
            <div class="row">
                <div class="col-md-12">
                    <div class="d-flex mt-4 justify-content-end">
                        <h6>Total Unit Tests<span class="badge bg-secondary me-4">{totalCount}</span></h6>
                        <h6>Passed<span class="badge bg-success me-4">{totalPassCount}</span></h6>
                        <h6>Failed<span class="badge bg-danger">{totalFailCount}</span></h6>
                    </div>
                </div>
            </div>
        </template>
        <lightning-accordion class="mt-3">
            <template for:each={executionResults} for:item="item">
                <lightning-accordion-section key={idx} class="my-1 accordion-shadow" label={item.header}>
                    <div class="d-flex justify-content-end">
                        <h6 class="mx-2">Total Tests <span class="badge bg-secondary">{item.unitTestsCount}</span></h6>
                        <h6 class="mx-2">Total Run Time(ms) <span class="badge bg-secondary">{item.totalRunTime}</span>
                        </h6>
                        <h6 class="mx-2">Pass <span class="badge bg-success">{item.passedTestCount}</span></h6>
                        <h6 class="mx-2">Fail <span class="badge bg-danger">{item.failTestCount}</span></h6>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th scope="col">Name</th>
                                <th scope="col">Outcome</th>
                                <th scope="col">Run Time</th>
                                <th scope="col">Git Info</th>
                            </tr>
                        </thead>
                        <tbody>
                            <template for:each={item.details} for:item="list">
                                <tr key={list.name}>
                                    <td>{list.name}</td>
                                    <td>
                                        <template lwc:if={list.outCome.result}>
                                            <svg style="color: #348b44; width: 20px;" aria-hidden="true"
                                                focusable="false" data-prefix="fas" data-icon="circle-check"
                                                class="svg-inline--fa fa-circle-check fa-1x Icon_green__3alcr"
                                                role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                <path fill="currentColor"
                                                    d="M0 256C0 114.6 114.6 0 256 0C397.4 0 512 114.6 512 256C512 397.4 397.4 512 256 512C114.6 512 0 397.4 0 256zM371.8 211.8C382.7 200.9 382.7 183.1 371.8 172.2C360.9 161.3 343.1 161.3 332.2 172.2L224 280.4L179.8 236.2C168.9 225.3 151.1 225.3 140.2 236.2C129.3 247.1 129.3 264.9 140.2 275.8L204.2 339.8C215.1 350.7 232.9 350.7 243.8 339.8L371.8 211.8z">
                                                </path>
                                            </svg>
                                        </template>
                                        <template lwc:else>
                                            <div role="button" data-id={list.outCome.error.errorId}
                                                data-stack={list.outCome.error.stackTrace}
                                                data-message={list.outCome.error.errorMessage}
                                                onclick={showModalErrorInfo}>
                                                <svg style="color: #aa5037; width: 20px;" aria-hidden="true"
                                                    focusable="false" data-prefix="fas" data-icon="triangle-exclamation"
                                                    class="svg-inline--fa fa-triangle-exclamation fa-1x Icon_red__2nlKA"
                                                    role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                                    <path fill="currentColor"
                                                        d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z">
                                                    </path>
                                                </svg>
                                            </div>
                                        </template>
                                    </td>
                                    <td>{list.runTime}</td>
                                    <td>
                                        <div class="d-flex">
                                            <div>
                                                <svg fill="#237d1e" width="25px" height="25px" viewBox="0 0 32 32"
                                                    version="1.1" xmlns="http://www.w3.org/2000/svg">
                                                    <title>commit</title>
                                                    <path
                                                        d="M0 16q0 0.832 0.576 1.44t1.44 0.576h8.352q0.64 1.792 2.176 2.88t3.456 1.12q1.952 0 3.488-1.12t2.144-2.88h8.384q0.8 0 1.408-0.576t0.576-1.44-0.576-1.408-1.408-0.576h-8.384q-0.608-1.76-2.144-2.88t-3.488-1.12q-1.92 0-3.456 1.12t-2.176 2.88h-8.352q-0.832 0-1.44 0.576t-0.576 1.408zM14.016 16q0-0.832 0.576-1.408t1.408-0.576 1.408 0.576 0.608 1.408-0.608 1.44-1.408 0.576-1.408-0.576-0.576-1.44z">
                                                    </path>
                                                </svg>
                                            </div>
                                            <div class="overflow-hidden text-nowrap mx-2" style="max-width: 39px;">
                                                <a class="text-info small" href={list.gitInfo.commitLink}
                                                    target="_blank" rel="noreferrer">{list.gitInfo.commitId}</a>
                                            </div>
                                            <div>
                                                <a class="text-info small" href={list.gitInfo.email}
                                                    title={list.gitInfo.email}>{list.gitInfo.author}</a>
                                            </div>
                                            <div>
                                                <span class="small"> {list.gitInfo.date}</span>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </template>

                        </tbody>
                    </table>

                </lightning-accordion-section>
            </template>
        </lightning-accordion>
    </template>
</template>